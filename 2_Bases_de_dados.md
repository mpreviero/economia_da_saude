Unindo bases: Dados (DATASUS) e *shapefile*
================

-   [Obtendo mapas e tabelas](#obtendo-mapas-e-tabelas)
    -   [Mapa: Objeto `sf`](#mapa-objeto-sf)
-   [TABNET: Equiptos de mamógrafos, óbitos por câncer de mama e planos de saúde](#tabnet-equiptos-de-mamógrafos-óbitos-por-câncer-de-mama-e-planos-de-saúde)
    -   [Número de Mamógrafos](#número-de-mamógrafos)
    -   [Óbitos por câncer de mama](#óbitos-por-câncer-de-mama)
    -   [Mulheres beneficiárias de plano de saúde privado por municipio e faixa etária](#mulheres-beneficiárias-de-plano-de-saúde-privado-por-municipio-e-faixa-etária)
    -   [Variáveis de controle (Atlas Brasil)](#variáveis-de-controle-atlas-brasil)
-   [Juntando as bases](#juntando-as-bases)
-   [Criando taxas](#criando-taxas)
    -   [Cálculo de taxas](#cálculo-de-taxas)
    -   [Agrupamento por classificação do equipamento mamógrafo (opicional)](#agrupamento-por-classificação-do-equipamento-mamógrafo-opicional)
-   [Outras bases (não utilizadas)](#outras-bases-não-utilizadas)
    -   [População Residente - Total por município](#população-residente---total-por-município)
    -   [População Residente - sexo Feminino por município](#população-residente---sexo-feminino-por-município)

``` r
rm(list=ls())
```

Obtendo mapas e tabelas
=======================

Mapa: Objeto `sf`
-----------------

Descrição: malha de municípios do Estado do Paraná

Período: 2015
Fonte: [IBGE - Malha Municipal 2015](ftp://geoftp.ibge.gov.br/organizacao_do_territorio/malhas_territoriais/malhas_municipais/municipio_2015/Leia-me_Malha_2015_final.pdf)

``` r
library(tidyverse)
library(janitor)
library(sf)

sf_parana <- st_read("./shp/pr/41MUE250GC_SIR.shp", quiet = TRUE) %>%
  transmute(municipio = as.character(NM_MUNICIP),
            cod_ibge  = as.integer(paste0(CD_GEOCMU))) %>%
  clean_names() %>%
  arrange(municipio) %>%
  glimpse()
```

    ## Observations: 399
    ## Variables: 3
    ## $ municipio <chr> "ABATIÁ", "ADRIANÓPOLIS", "AGUDOS DO SUL", "ALMIRANT...
    ## $ cod_ibge  <int> 4100103, 4100202, 4100301, 4100400, 4100459, 4128625...
    ## $ geometry  <POLYGON [Â°]> POLYGON ((-50.23476 -23.356..., POLYGON ((-...

``` r
# st_write(sf_parana, "./Tabelas/shp/pr/sf_parana.shp")
```

TABNET: Equiptos de mamógrafos, óbitos por câncer de mama e planos de saúde
===========================================================================

Número de Mamógrafos
--------------------

Descrição: Número de mamógrafos existentes, em uso e disponíveis pelo SUS.

Período: maio/2010
Fonte: [TABNET/CNES](http://www2.datasus.gov.br/DATASUS/index.php?area=0204&id=11671&VObj=http://tabnet.datasus.gov.br/cgi/deftohtm.exe?cnes/cnv/equipo)

``` r
library(readxl)

mamografos_parana <- read_excel("./Tabelas/mamografos_parana.xlsx") %>%
 mutate(cod_munici = str_sub(municipio, start = 1L, end = 6L),
        munic      = str_sub(municipio, start = 8L))  %>%
 mutate_if(is.character, funs(toupper)) %>%
 mutate_if(is.double, funs(as.integer)) %>%
 select(-c(1))  %>%
 rename(municipio = munic,
        mamografos_sus = mamografos_disponiveis) %>%
 select(cod_munici, municipio, everything()) %>%
 glimpse()
```

    ## Observations: 399
    ## Variables: 5
    ## $ cod_munici            <chr> "410010", "410020", "410030", "410040", ...
    ## $ municipio             <chr> "ABATIÁ", "ADRIANÓPOLIS", "AGUDOS DO SUL...
    ## $ mamografos_existentes <int> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0...
    ## $ mamografos_em_uso     <int> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0...
    ## $ mamografos_sus        <int> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0...

``` r
#write_rds(mamografos_parana, "./Tabelas/mamografos_parana.rds")
```

Óbitos por câncer de mama
-------------------------

Descrição: Óbitos p/Residência, por Município e Faixa Etária Grupo CID-10: Neoplasias malignas da mama Cor/raça: Branca, Preta, Amarela, Parda, Indígena, Ignorado

Período:2010

Fonte: [MS/SVS/CGIAE - Sistema de Informações sobre Mortalidade - SIM](http://www2.datasus.gov.br/DATASUS/index.php?area=0205&id=6937)

``` r
obitos_cancer <- read_excel("./Tabelas/obitos_cancer.xlsx") %>%
 mutate(cod_munici = str_sub(municipio, start = 1L, end = 6L),
        munic      = str_sub(municipio, start = 8L))  %>%
 mutate_if(is.character, funs(toupper)) %>%
 mutate_if(is.double, funs(as.integer)) %>%
 select(-c(1))  %>%
 rename(municipio = munic) %>%
 clean_names() %>%
 select(cod_munici, municipio, everything()) %>%
 glimpse()
```

    ## Observations: 399
    ## Variables: 16
    ## $ cod_munici            <chr> "410010", "410020", "410030", "410040", ...
    ## $ municipio             <chr> "ABATIÁ", "ADRIANÓPOLIS", "AGUDOS DO SUL...
    ## $ obitos_20_a_29_anos   <int> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0...
    ## $ obitos_30_a_39_anos   <int> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0...
    ## $ obitos_40_a_49_anos   <int> 0, 2, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0...
    ## $ obitos_50_a_59_anos   <int> 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1...
    ## $ obitos_60_a_69_anos   <int> 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0...
    ## $ obitos_70_a_79_anos   <int> 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1...
    ## $ obitos_80_anos_e_mais <int> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0...
    ## $ obitos_total_idade    <int> 0, 2, 0, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2...
    ## $ obitos_cor_branca     <int> 0, 1, 0, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2...
    ## $ obitos_cor_preta      <int> 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0...
    ## $ obitos_cor_amarela    <int> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0...
    ## $ obitos_cor_parda      <int> 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0...
    ## $ obitos_cor_ignorado   <int> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0...
    ## $ obitos_cor_total_raca <int> 0, 2, 0, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2...

``` r
#write_rds(obitos_cancer, "./Tabelas/obitos_cancer.rds")
```

Mulheres beneficiárias de plano de saúde privado por municipio e faixa etária
-----------------------------------------------------------------------------

Descrição: Beneficiários de planos privados de saúde - sexo feminino e por faixa etária (Excl. Odontológico por Município e Faixa etária). O termo "beneficiário" refere-se a vínculos aos planos de saúde, podendo incluir vários vínculos para um mesmo indivíduo.

UF: Paraná
Sexo: Feminino
Período: jun/2010
Fonte: [Agência nacional de Saúde (ANS) - Dados e indicadores do setor](http://www.ans.gov.br/anstabnet/cgi-bin/dh?dados/tabnet_02.def)

``` r
planos_parana <- read_excel("./Tabelas/planos_de_saude_privado.xlsx")[1:366,] %>%
 mutate(cod_munici = str_sub(municipio, start = 1L, end = 6L),
        munic      = str_sub(municipio, start = 8L)) %>%
 mutate_if(is.character, funs(toupper)) %>%
 mutate_if(is.double, funs(as.integer)) %>%
 select(-c(1)) %>%
 rename(municipio = munic,
        planos_saude = Total) %>% 
  # um problema é que a base de dado não contém 36 municipios que não tem registro de plano de saúde
  # então, 'mamografos_parna$disponiveis_sus' faz o pivot para que meu resultado inclua esses 36 municipios na bd
  full_join(mamografos_parana %>% select(c(municipio, cod_munici, mamografos_sus)),
           .,
           by=c("municipio", "cod_munici")) %>%
 select(c(2,1,23)) %>%
 glimpse()
```

    ## Observations: 399
    ## Variables: 3
    ## $ cod_munici   <chr> "410010", "410020", "410030", "410040", "410045",...
    ## $ municipio    <chr> "ABATIÁ", "ADRIANÓPOLIS", "AGUDOS DO SUL", "ALMIR...
    ## $ planos_saude <int> 17, 8, 50, 1, 5, 3, 7, 9, 12, 11, 1, 8, 2, 108, 4...

``` r
#readr::write_rds(planos_parana, "./Tabelas/planos_de_saude_privado.rds")
```

Variáveis de controle (Atlas Brasil)
------------------------------------

``` r
atlas_brasil <- read_excel("./Tabelas/atlas_brasil_consulta.xlsx") %>%
  mutate_at(c(4:6, 47:48, 29:39, 41:46, 12:28), funs(as.integer)) %>%
  select(c(1,               # municipios
           4:6, 47:48,      # população total
           29:39, 41:46,    # população: sexo feminino por faixa etária
           12:28,           # população: sexo masculino por faixa etária
           2, 3, 11, 40, 49,# gini, esp. de vida ao nascer, envelhecimento, analfabetismo
           50:56,           # renda per capita
           7:10     )) %>%  # idhm
  clean_names() %>%
  arrange(espacialidades) %>%
  bind_cols(select(mamografos_parana, c(cod_munici, municipio)), .) %>%
  select(-espacialidades) %>%
  glimpse()
```

    ## Observations: 399
    ## Variables: 57
    ## $ cod_munici                                          <chr> "410010", ...
    ## $ municipio                                           <chr> "ABATIÁ", ...
    ## $ populacao_total_2010                                <int> 7764, 6376...
    ## $ populacao_rural_2010                                <int> 2032, 4316...
    ## $ populacao_urbana_2010                               <int> 5732, 2060...
    ## $ populacao_residente_masculina_2010                  <int> 3916, 3298...
    ## $ populacao_residente_feminina_2010                   <int> 3848, 3078...
    ## $ populacao_feminina_de_0_a_4_anos_2010               <int> 220, 236, ...
    ## $ populacao_feminina_de_5_a_9_anos_2010               <int> 240, 267, ...
    ## $ populacao_feminina_de_10_a_14_anos_2010             <int> 340, 322, ...
    ## $ populacao_feminina_de_15_a_19_anos_2010             <int> 362, 288, ...
    ## $ populacao_feminina_de_20_a_24_anos_2010             <int> 313, 207, ...
    ## $ populacao_feminina_de_25_a_29_anos_2010             <int> 255, 217, ...
    ## $ populacao_feminina_de_30_a_34_anos_2010             <int> 252, 176, ...
    ## $ populacao_feminina_de_35_a_39_anos_2010             <int> 286, 203, ...
    ## $ populacao_feminina_de_40_a_44_anos_2010             <int> 280, 196, ...
    ## $ populacao_feminina_de_45_a_49_anos_2010             <int> 268, 198, ...
    ## $ populacao_feminina_de_50_a_54_anos_2010             <int> 246, 166, ...
    ## $ populacao_feminina_de_55_a_59_anos_2010             <int> 204, 152, ...
    ## $ populacao_feminina_de_60_a_64_anos_2010             <int> 173, 124, ...
    ## $ populacao_feminina_de_65_a_69_anos_2010             <int> 141, 111, ...
    ## $ populacao_feminina_de_70_a_74_anos_2010             <int> 120, 86, 9...
    ## $ populacao_feminina_de_75_a_79_anos_2010             <int> 81, 60, 38...
    ## $ populacao_feminina_com_80_anos_e_mais_2010          <int> 67, 69, 60...
    ## $ populacao_masculina_de_0_a_4_anos_2010              <int> 249, 241, ...
    ## $ populacao_masculina_de_5_a_9_anos_2010              <int> 271, 323, ...
    ## $ populacao_masculina_de_10_a_14_anos_2010            <int> 347, 380, ...
    ## $ populacao_masculina_de_15_a_19_anos_2010            <int> 387, 336, ...
    ## $ populacao_masculina_de_20_a_24_anos_2010            <int> 280, 209, ...
    ## $ populacao_masculina_de_25_a_29_anos_2010            <int> 282, 217, ...
    ## $ populacao_masculina_de_30_a_34_anos_2010            <int> 278, 196, ...
    ## $ populacao_masculina_de_35_a_39_anos_2010            <int> 262, 182, ...
    ## $ populacao_masculina_de_40_a_44_anos_2010            <int> 312, 196, ...
    ## $ populacao_masculina_de_45_a_49_anos_2010            <int> 287, 187, ...
    ## $ populacao_masculina_de_50_a_54_anos_2010            <int> 254, 185, ...
    ## $ populacao_masculina_de_55_a_59_anos_2010            <int> 183, 178, ...
    ## $ populacao_masculina_de_60_a_64_anos_2010            <int> 164, 122, ...
    ## $ populacao_masculina_de_65_a_69_anos_2010            <int> 130, 117, ...
    ## $ populacao_masculina_de_70_a_74_anos_2010            <int> 103, 99, 1...
    ## $ populacao_masculina_de_75_a_79_anos_2010            <int> 62, 66, 54...
    ## $ populacao_masculina_com_80_anos_e_mais_2010         <int> 65, 64, 44...
    ## $ indice_de_gini_2010                                 <dbl> 0.44, 0.53...
    ## $ esperanca_de_vida_ao_nascer_2010                    <dbl> 73.23, 74....
    ## $ probabilidade_de_sobrevivencia_ate_60_anos_2010     <dbl> 80.80, 82....
    ## $ taxa_de_envelhecimento_2010                         <dbl> 9.90, 10.5...
    ## $ taxa_de_analfabetismo_15_anos_ou_mais_2010          <dbl> 16.76, 16....
    ## $ renda_per_capita_2010                               <dbl> 535.86, 44...
    ## $ renda_per_capita_media_do_1º_quinto_mais_pobre_2010 <dbl> 135.31, 71...
    ## $ renda_per_capita_media_do_2º_quinto_mais_pobre_2010 <dbl> 269.72, 16...
    ## $ renda_per_capita_media_do_3º_quinto_mais_pobre_2010 <dbl> 392.81, 26...
    ## $ renda_per_capita_media_do_4º_quinto_mais_pobre_2010 <dbl> 547.63, 43...
    ## $ renda_per_capita_dos_extremamente_pobres_2010       <dbl> 30.74, 26....
    ## $ renda_per_capita_dos_pobres_2010                    <dbl> 83.47, 78....
    ## $ idhm_2010                                           <dbl> 0.687, 0.6...
    ## $ idhm_renda_2010                                     <dbl> 0.676, 0.6...
    ## $ idhm_longevidade_2010                               <dbl> 0.804, 0.8...
    ## $ idhm_educacao_2010                                  <dbl> 0.596, 0.5...

``` r
#readr::write_rds(atlas_brasil, "./Tabelas/atlas_brasil_consulta.rds")
```

Juntando as bases
=================

``` r
rm(list=ls())

library(tidyverse)
library(sf)
library(readxl)

# o mapa...
sf_parana <- st_read(".\\shp\\pr\\sf_parana.shp", quiet = TRUE) %>%
  select(cod_ibge, everything())

# ...os equiptos de mamógrafos...
mamografos_parana <- read_rds("./Tabelas/mamografos_parana.rds") %>%
  mutate(municipio = as.factor(municipio))

# ...Os óbitos por câncer...
obitos_cancer <- read_rds("./Tabelas/obitos_cancer.rds") %>%
  mutate(municipio = as.factor(municipio)) %>%
  select(-cod_munici)

# ...os planos de saúde...
planos_parana <- read_rds("./Tabelas/planos_de_saude_privado.rds") %>%
  mutate(municipio = as.factor(municipio)) %>%
  select(-cod_munici)

# ...atlas brasil...
atlas_brasil <- read_rds("./Tabelas/atlas_brasil_consulta.rds") %>%
  mutate(municipio = as.factor(municipio)) %>%
  select(-cod_munici)

# The Union is done!
base_parana <- inner_join(sf_parana, mamografos_parana, by = "municipio") %>% # o mapa + os eqptos de mamógrafos...
               inner_join(., obitos_cancer, by = "municipio") %>%           # + ...os óbitos por câncer de mama...
               inner_join(., planos_parana, by = "municipio") %>%           # + ...os planos de saúde...  
               inner_join(., atlas_brasil, by = "municipio") %>%            # + ...o atlas_brasil...
               select(cod_ibge, cod_munici, municipio, everything()) %>%

               glimpse()
```

    ## Observations: 399
    ## Variables: 77
    ## $ cod_ibge                                            <int> 4100103, 4...
    ## $ cod_munici                                          <chr> "410010", ...
    ## $ municipio                                           <fct> ABATIÁ, AD...
    ## $ mamografos_existentes                               <int> 0, 0, 0, 0...
    ## $ mamografos_em_uso                                   <int> 0, 0, 0, 0...
    ## $ mamografos_sus                                      <int> 0, 0, 0, 0...
    ## $ obitos_20_a_29_anos                                 <int> 0, 0, 0, 0...
    ## $ obitos_30_a_39_anos                                 <int> 0, 0, 0, 0...
    ## $ obitos_40_a_49_anos                                 <int> 0, 2, 0, 2...
    ## $ obitos_50_a_59_anos                                 <int> 0, 0, 0, 2...
    ## $ obitos_60_a_69_anos                                 <int> 0, 0, 0, 1...
    ## $ obitos_70_a_79_anos                                 <int> 0, 0, 0, 1...
    ## $ obitos_80_anos_e_mais                               <int> 0, 0, 0, 0...
    ## $ obitos_total_idade                                  <int> 0, 2, 0, 6...
    ## $ obitos_cor_branca                                   <int> 0, 1, 0, 5...
    ## $ obitos_cor_preta                                    <int> 0, 0, 0, 1...
    ## $ obitos_cor_amarela                                  <int> 0, 0, 0, 0...
    ## $ obitos_cor_parda                                    <int> 0, 1, 0, 0...
    ## $ obitos_cor_ignorado                                 <int> 0, 0, 0, 0...
    ## $ obitos_cor_total_raca                               <int> 0, 2, 0, 6...
    ## $ planos_saude                                        <int> 17, 8, 50,...
    ## $ populacao_total_2010                                <int> 7764, 6376...
    ## $ populacao_rural_2010                                <int> 2032, 4316...
    ## $ populacao_urbana_2010                               <int> 5732, 2060...
    ## $ populacao_residente_masculina_2010                  <int> 3916, 3298...
    ## $ populacao_residente_feminina_2010                   <int> 3848, 3078...
    ## $ populacao_feminina_de_0_a_4_anos_2010               <int> 220, 236, ...
    ## $ populacao_feminina_de_5_a_9_anos_2010               <int> 240, 267, ...
    ## $ populacao_feminina_de_10_a_14_anos_2010             <int> 340, 322, ...
    ## $ populacao_feminina_de_15_a_19_anos_2010             <int> 362, 288, ...
    ## $ populacao_feminina_de_20_a_24_anos_2010             <int> 313, 207, ...
    ## $ populacao_feminina_de_25_a_29_anos_2010             <int> 255, 217, ...
    ## $ populacao_feminina_de_30_a_34_anos_2010             <int> 252, 176, ...
    ## $ populacao_feminina_de_35_a_39_anos_2010             <int> 286, 203, ...
    ## $ populacao_feminina_de_40_a_44_anos_2010             <int> 280, 196, ...
    ## $ populacao_feminina_de_45_a_49_anos_2010             <int> 268, 198, ...
    ## $ populacao_feminina_de_50_a_54_anos_2010             <int> 246, 166, ...
    ## $ populacao_feminina_de_55_a_59_anos_2010             <int> 204, 152, ...
    ## $ populacao_feminina_de_60_a_64_anos_2010             <int> 173, 124, ...
    ## $ populacao_feminina_de_65_a_69_anos_2010             <int> 141, 111, ...
    ## $ populacao_feminina_de_70_a_74_anos_2010             <int> 120, 86, 9...
    ## $ populacao_feminina_de_75_a_79_anos_2010             <int> 81, 60, 38...
    ## $ populacao_feminina_com_80_anos_e_mais_2010          <int> 67, 69, 60...
    ## $ populacao_masculina_de_0_a_4_anos_2010              <int> 249, 241, ...
    ## $ populacao_masculina_de_5_a_9_anos_2010              <int> 271, 323, ...
    ## $ populacao_masculina_de_10_a_14_anos_2010            <int> 347, 380, ...
    ## $ populacao_masculina_de_15_a_19_anos_2010            <int> 387, 336, ...
    ## $ populacao_masculina_de_20_a_24_anos_2010            <int> 280, 209, ...
    ## $ populacao_masculina_de_25_a_29_anos_2010            <int> 282, 217, ...
    ## $ populacao_masculina_de_30_a_34_anos_2010            <int> 278, 196, ...
    ## $ populacao_masculina_de_35_a_39_anos_2010            <int> 262, 182, ...
    ## $ populacao_masculina_de_40_a_44_anos_2010            <int> 312, 196, ...
    ## $ populacao_masculina_de_45_a_49_anos_2010            <int> 287, 187, ...
    ## $ populacao_masculina_de_50_a_54_anos_2010            <int> 254, 185, ...
    ## $ populacao_masculina_de_55_a_59_anos_2010            <int> 183, 178, ...
    ## $ populacao_masculina_de_60_a_64_anos_2010            <int> 164, 122, ...
    ## $ populacao_masculina_de_65_a_69_anos_2010            <int> 130, 117, ...
    ## $ populacao_masculina_de_70_a_74_anos_2010            <int> 103, 99, 1...
    ## $ populacao_masculina_de_75_a_79_anos_2010            <int> 62, 66, 54...
    ## $ populacao_masculina_com_80_anos_e_mais_2010         <int> 65, 64, 44...
    ## $ indice_de_gini_2010                                 <dbl> 0.44, 0.53...
    ## $ esperanca_de_vida_ao_nascer_2010                    <dbl> 73.23, 74....
    ## $ probabilidade_de_sobrevivencia_ate_60_anos_2010     <dbl> 80.80, 82....
    ## $ taxa_de_envelhecimento_2010                         <dbl> 9.90, 10.5...
    ## $ taxa_de_analfabetismo_15_anos_ou_mais_2010          <dbl> 16.76, 16....
    ## $ renda_per_capita_2010                               <dbl> 535.86, 44...
    ## $ renda_per_capita_media_do_1º_quinto_mais_pobre_2010 <dbl> 135.31, 71...
    ## $ renda_per_capita_media_do_2º_quinto_mais_pobre_2010 <dbl> 269.72, 16...
    ## $ renda_per_capita_media_do_3º_quinto_mais_pobre_2010 <dbl> 392.81, 26...
    ## $ renda_per_capita_media_do_4º_quinto_mais_pobre_2010 <dbl> 547.63, 43...
    ## $ renda_per_capita_dos_extremamente_pobres_2010       <dbl> 30.74, 26....
    ## $ renda_per_capita_dos_pobres_2010                    <dbl> 83.47, 78....
    ## $ idhm_2010                                           <dbl> 0.687, 0.6...
    ## $ idhm_renda_2010                                     <dbl> 0.676, 0.6...
    ## $ idhm_longevidade_2010                               <dbl> 0.804, 0.8...
    ## $ idhm_educacao_2010                                  <dbl> 0.596, 0.5...
    ## $ geometry                                            <POLYGON [Â°]> P...

``` r
#write_rds(base_parana, "./Tabelas/base_parana.rds")
```

Criando taxas
=============

Cálculo de taxas
----------------

``` r
rm(list=ls())

library(sf)
library(tidyverse)
library(scales)

base_parana <- read_rds("./Tabelas/base_parana.rds")

base_parana[is.na(base_parana)] <- 0

taxas <- tibble(variavel = colnames(base_parana)) %>%
  filter(str_detect(variavel, "mamografo|obitos_total_idade|plano")) %>%
  as_vector()

base_parana <- base_parana %>%
  # criando mais algumas variáveis
  mutate(area_km2              = round(unclass(st_area(.))[1:399]/1000000),
         dens_demogr           = populacao_total_2010/area_km2,
         prop_populacao_urbana = populacao_urbana_2010/populacao_total_2010,
         populacao_mulheres    = as.integer(base_parana %>% st_set_geometry(NULL) %>%
                                            select(30:44) %>% rowSums)) %>%
  #definindo taxas
  mutate_at(.funs = funs(taxa = (./populacao_mulheres)*1000), .vars = taxas)

#write_rds(base_parana, "./Tabelas/base_parana.rds")
```

Agrupamento por classificação do equipamento mamógrafo (opicional)
------------------------------------------------------------------

Os mamógrafos são classificados por:

-   Existentes: Soma de todos os mamógrafos existentes na localidade
-   Em uso: Subtrai os mamógrafos sem uso dos existentes
-   Disponível pelo SUS: mamógrafos utilizados na rede pública de saúde

Para começar a análise, optamos pelo agrupamento dos dados nesas 3 categorias. A função `purrr::nest` faz esse trabalho aninhando uma base de dados para cada categoria.

``` r
rm(list=ls())

library(sf)
library(tidyverse)
library(readr)
library(scales)

(base_parana <- read_rds("./Tabelas/base_parana.rds") %>% 
   gather(situacao, quantidade_mamografos,
          -c(cod_ibge:municipio, obitos_20_a_29_anos:idhm_educacao_2010, geometry),
          factor_key = T) %>%
   group_by(situacao) %>%
   nest())
```

    ## # A tibble: 12 x 2
    ##    situacao                   data               
    ##    <fct>                      <list>             
    ##  1 mamografos_existentes      <tibble [399 x 75]>
    ##  2 mamografos_em_uso          <tibble [399 x 75]>
    ##  3 mamografos_sus             <tibble [399 x 75]>
    ##  4 area_km2                   <tibble [399 x 75]>
    ##  5 dens_demogr                <tibble [399 x 75]>
    ##  6 prop_populacao_urbana      <tibble [399 x 75]>
    ##  7 populacao_mulheres         <tibble [399 x 75]>
    ##  8 mamografos_existentes_taxa <tibble [399 x 75]>
    ##  9 mamografos_em_uso_taxa     <tibble [399 x 75]>
    ## 10 mamografos_sus_taxa        <tibble [399 x 75]>
    ## 11 obitos_total_idade_taxa    <tibble [399 x 75]>
    ## 12 planos_saude_taxa          <tibble [399 x 75]>

------------------------------------------------------------------------

------------------------------------------------------------------------

------------------------------------------------------------------------

Outras bases (não utilizadas)
=============================

População Residente - Total por município
-----------------------------------------

Descrição: Estimativas de 1992 a 2016 utilizadas pelo TCU para determinação das cotas do FPM (sem sexo e faixa etária)

Período: 2015
Fonte: [TABNET/Demográficas e Sócioeconômicas](http://www2.datasus.gov.br/DATASUS/index.php?area=0206&id=6943&VObj=http://tabnet.datasus.gov.br/cgi/deftohtm.exe?ibge/cnv/popt)

``` r
library(abjutils)

populacao_parana <- read_excel("./Tabelas/populacao_estimada_2015.xlsx") %>%
 clean_names() %>%
 set_names(rm_accent) %>%
 arrange(municipio) %>%
 mutate(cod_munici = str_sub(municipio, start = 1L, end = 6L),
        munic      = str_sub(municipio, start = 8L)) %>%
 mutate_if(is.character, funs(toupper)) %>%
 select(-c(1))  %>%
 rename(municipio = munic) %>%
 select(cod_munici, municipio, everything()) %>%
 glimpse()
```

    ## Observations: 399
    ## Variables: 3
    ## $ cod_munici         <chr> "410010", "410020", "410030", "410040", "41...
    ## $ municipio          <chr> "ABATIÁ", "ADRIANÓPOLIS", "AGUDOS DO SUL", ...
    ## $ populacao_estimada <dbl> 7823, 6333, 8983, 112870, 3341, 21744, 1451...

``` r
#write_rds(populacao_parana, "./Tabelas/populacao_estimada_2015.rds")
```

População Residente - sexo Feminino por município
-------------------------------------------------

Descrição: Estudo de Estimativas Populacionais por Município, Idade e Sexo 2000-2015 - Brasil População residente por Município e Faixa Etária 1

UF: Paraná
Sexo: Feminino
Período: 2015
Fonte: [2014 e 2015 – Estimativas preliminares elaboradas pelo Ministério da Saúde/SVS/CGIAE.](http://www2.datasus.gov.br/DATASUS/index.php?area=0206&id=6943&VObj=http://tabnet.datasus.gov.br/cgi/deftohtm.exe?ibge/cnv/popt)

``` r
pop_feminina <- read_excel("./Tabelas/populacao_feminina_2015.xlsx") %>%
 clean_names() %>%
 arrange(municipio) %>%
 mutate(cod_munici = str_sub(municipio, start = 1L, end = 6L),
        munic      = str_sub(municipio, start = 8L)) %>%
 mutate_if(is.character, funs(toupper)) %>%
 select(cod_munici,
        munic,
        x15_a_19_anos:x80_anos_e_mais) %>%
 rename(municipio = munic) %>%
 mutate(populacao_mulheres = rowSums(select(., x15_a_19_anos:x80_anos_e_mais))) %>%
 select(-c(3:10)) %>%
 select(cod_munici, municipio, everything()) %>%
 glimpse()
```

    ## Observations: 399
    ## Variables: 3
    ## $ cod_munici         <chr> "410010", "410020", "410030", "410040", "41...
    ## $ municipio          <chr> "ABATIÁ", "ADRIANÓPOLIS", "AGUDOS DO SUL", ...
    ## $ populacao_mulheres <dbl> 3150, 2305, 3311, 42618, 1283, 8604, 5725, ...

``` r
#readr::write_rds(pop_feminina, "./Tabelas/populacao_feminina_2015.rds")
```
